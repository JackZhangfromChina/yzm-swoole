# Swoole 编程须知

## 睡眠函数的影响 [sleep.php]

1.睡眠函数会使工作进程陷入阻塞，直到指定时间后操作系统才会唤醒进程。

2.Swoole Server 无法再处理新的请求。

处理方式
```
1.不使用睡眠/阻塞IO函数

2.设置多个工作进程

3.开启协程定时器调度
```

## 中止函数的影响 [exit.php]

1.中止函数 (exit, die) 会使工作进程立即退出，异常退出会被 master 重新拉起，从而导致工作进程不断退出和拉起。

2.产生大量警报日志。

3.导致当前进程内的其它任务被丢弃。

处理方式
```
1.不使用中止函数 (exit, die)。

2.最外层使用 try / catch 捕获异常。

使用 try/catch 好处：

    1.当前工作进程不会退出，资源不会被销毁。

    2.当前工作进程依然可以处理其它任务。
```

## 死循环的影响 [while.php]

1.死循环取得控制权后，IO 事件回调函数无法触发，无法再收到客户端请求。

2.必须等待循环结束才能继续处理新的事件。

处理方式
```
1.处理程序中的死循环。

2.增加工作进程提高处理能力。
```

## 随机函数的影响 [rand.php]

主进程使用过随机数发生器，子进程内 rand 返回的结果是相同的，使用随机数发生器的函数有 rand, srand, shuffle, array_rand。

处理方式
```
1.主进程内不使用随机数函数。

2.在子进程内使用 srand 重新播种。
```

## 进程隔离 [isolation.php]

进程隔离是为保护操作系统中进程互不干扰而设计的一组不同硬件和软件的技术。进程彼此的内存空间是独立的。

进程隔离意味着什么 ?
```
1. 多进程程序进程间都是彼此隔离的，比如我们自己用 fork 实现的。

2. Swoole 的多进程间必然也是彼此隔离的。
```

进程间如何通信 ?
```
1. 传统进程间通信方式有：管道、共享内存、消息队列、信号量、网络套接字
（完整实现可参考 https://github.com/farwish/PCP ）

2. Swoole 提供的方式有：Swoole\Table、Swoole\Atomic
```
